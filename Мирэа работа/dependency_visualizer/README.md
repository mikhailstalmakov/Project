# Инструмент визуализации графа зависимостей

## Общее описание
Это CLI-приложение для визуализации графа зависимостей пакетов Python. Разработка ведется поэтапно согласно требованиям практической работы (Вариант №20).

## Структура проекта
- `main.py` - главный модуль приложения
- `config.py` - класс для работы с XML конфигурацией
- `dependency_fetcher.py` - модуль для получения зависимостей из PyPI или тестового файла
- `graph_builder.py` - модуль для построения графа зависимостей (DFS алгоритм)
- `visualizer.py` - модуль для визуализации графа в формате D2 и SVG
- `config.xml` - пример конфигурационного файла для работы с PyPI
- `config_test.xml` - пример конфигурационного файла для тестового режима
- `test_repo.txt` - тестовый репозиторий с зависимостями

## Этап 1: Минимальный прототип с конфигурацией ✅
- Конфигурация задается в XML-файле
- Параметры: имя пакета, URL репозитория, режим тестирования, имя выходного файла, подстрока фильтра
- При запуске выводятся все параметры в формате ключ-значение
- Реализована обработка ошибок для всех параметров

## Этап 2: Сбор данных ✅
- Используется формат пакетов Python (pip)
- Извлечение информации о прямых зависимостях из PyPI API
- Поддержка тестового режима с файлом репозитория
- Вывод всех прямых зависимостей заданного пакета

## Этап 3: Основные операции ✅
- Построение графа зависимостей с учетом транзитивности (алгоритм DFS с рекурсией)
- Фильтрация пакетов по подстроке
- Обработка циклических зависимостей
- Поддержка режима тестирования с файлом описания графа

## Этап 4: Дополнительные операции ✅
- Режим вывода обратных зависимостей для заданного пакета
- Использование алгоритма обхода из предыдущего этапа
- Демонстрация на различных случаях работы с тестовым репозиторием

## Этап 5: Визуализация ✅
- Формирование текстового представления графа на языке D2
- Сохранение изображения графа в формате SVG
- Поддержка примеров визуализации для различных пакетов

## Описание параметров конфигурации
- `package_name`: Имя анализируемого пакета
- `repo_url`: URL-адрес репозитория PyPI (например, `https://pypi.org/pypi/requests/json`) или путь к тестовому файлу
- `test_mode`: Режим работы с тестовым репозиторием (`true`/`false`)
- `output_file`: Имя сгенерированного файла с изображением графа (SVG)
- `filter_substring`: Подстрока для фильтрации пакетов (пустая строка = без фильтрации)

## Установка зависимостей
Проект использует только стандартную библиотеку Python 3. Для генерации SVG из D2 кода требуется установить компилятор D2:

### Windows
```powershell
# Скачать с https://d2lang.com/install
# Или через winget:
winget install Terrastruct.D2
```

### Linux/Mac
```bash
curl -fsSL https://d2lang.com/install.sh | sh
```

## Запуск приложения

### Базовый запуск
```bash
python main.py config.xml
```

### Запуск с тестовым репозиторием
```bash
python main.py config_test.xml
```

### Запуск с фильтрацией
```bash
python main.py config_test_filter.xml
```

### Запуск с выводом обратных зависимостей
```bash
python main.py config_test.xml --reverse E
```

## Примеры конфигурационных файлов

### Работа с PyPI (config.xml)
```xml
<?xml version="1.0" encoding="UTF-8"?>
<config>
    <package_name>requests</package_name>
    <repo_url>https://pypi.org/pypi/requests/json</repo_url>
    <test_mode>false</test_mode>
    <output_file>graph.svg</output_file>
    <filter_substring>test</filter_substring>
</config>
```

### Тестовый режим (config_test.xml)
```xml
<?xml version="1.0" encoding="UTF-8"?>
<config>
    <package_name>A</package_name>
    <repo_url>test_repo.txt</repo_url>
    <test_mode>true</test_mode>
    <output_file>graph_test.svg</output_file>
    <filter_substring></filter_substring>
</config>
```

### Тестовый режим с фильтрацией (config_test_filter.xml)
```xml
<?xml version="1.0" encoding="UTF-8"?>
<config>
    <package_name>A</package_name>
    <repo_url>test_repo.txt</repo_url>
    <test_mode>true</test_mode>
    <output_file>graph_test_filter.svg</output_file>
    <filter_substring>I</filter_substring>
</config>
```

## Формат тестового репозитория
Тестовый файл должен иметь формат:
```
PACKAGE: DEP1 DEP2 DEP3
```

Где:
- Пакеты называются большими латинскими буквами
- Каждая строка определяет зависимости одного пакета
- Строки, начинающиеся с `#`, игнорируются (комментарии)

Пример:
```
A: B C D
B: E F
C: E G
```

## Пример вывода
```
Welcome to dependency visualizer
Configuration parameters:
  package_name: requests
  repo_url: https://pypi.org/pypi/requests/json
  test_mode: False
  output_file: graph.svg
  filter_substring: test

============================================================
Stage 2: Direct Dependencies
============================================================
Direct dependencies of 'requests':
  - certifi
  - charset-normalizer
  - idna
  - urllib3

============================================================
Stage 3: Dependency Graph Construction
============================================================
Dependency graph for 'requests':
Total packages in graph: 15
...

============================================================
Stage 5: Visualization
============================================================
D2 code:
==================================================
// Dependency graph visualization

requests -> certifi
requests -> charset-normalizer
...
==================================================
SVG file generated: graph.svg
```

## Обработка ошибок
Приложение обрабатывает следующие типы ошибок:
- Отсутствие конфигурационного файла
- Некорректный формат XML
- Отсутствие или пустые значения параметров
- Некорректные булевы значения
- Отсутствие пакета на PyPI
- Ошибки сети при запросе к PyPI
- Отсутствие тестового файла
- Циклические зависимости (обнаруживаются и выводятся как предупреждение)

## Особенности реализации
1. **Алгоритм DFS**: Используется рекурсивный обход в глубину для построения графа
2. **Обнаружение циклов**: Отслеживается текущий путь обхода для выявления циклических зависимостей
3. **Фильтрация**: Пакеты, содержащие подстроку фильтра, исключаются из анализа
4. **Тестовый режим**: Позволяет работать с локальным файлом вместо PyPI API
5. **Визуализация**: Генерируется код D2, который затем компилируется в SVG

## Сравнение с штатными инструментами
Для сравнения результатов можно использовать:
- `pip show <package>` - показывает прямые зависимости
- `pipdeptree` - показывает дерево зависимостей
- `pip list --format=tree` - альтернативный формат

Возможные расхождения могут быть связаны с:
- Разными версиями пакетов
- Условными зависимостями (extras)
- Обработкой опциональных зависимостей
- Различиями в алгоритмах обхода графа
